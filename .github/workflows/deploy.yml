    steps:
      - name: Download latest native binary artifact
        ...

      - name: Verify downloaded binary
        ...

      - name: Install cloudflared
        run: |
          wget -q https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb
          sudo dpkg -i cloudflared-linux-amd64.deb

      - name: Cloudflare Access login (manual)
        run: |
          cloudflared access login https://trafik-ssh.svante-for-the.win
          echo ""
          echo "Öppna URL:en ovan i din webbläsare, logga in via Cloudflare Access"
          echo "När sidan bekräftar att du är inloggad, låt jobben fortsätta."

      - name: Configure SSH client
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.PI_SSH_KEY }}" > ~/.ssh/id_ed25519_ci
          chmod 600 ~/.ssh/id_ed25519_ci

          cat <<'EOF' >> ~/.ssh/config
          Host trafik-pi
            HostName trafik-ssh.svante-for-the.win
            User admin
            IdentityFile ~/.ssh/id_ed25519_ci
            IdentitiesOnly yes
            ProxyCommand cloudflared access ssh --hostname %h
          EOF

      - name: Copy binary to /opt/livetrafik on Raspberry Pi
        run: |
          scp trafik-websocket-server-linux-arm64 trafik-pi:/home/admin/trafik-websocket-server-linux-arm64

          ssh trafik-pi <<'EOSSH'
          sudo mv /home/admin/trafik-websocket-server-linux-arm64 /opt/livetrafik/trafik-websocket-server-linux-arm64
          sudo chown root:root /opt/livetrafik/trafik-websocket-server-linux-arm64
          sudo chmod 755 /opt/livetrafik/trafik-websocket-server-linux-arm64
          EOSSH

      - name: Restart livetrafik-ws.service on Raspberry Pi
        if: ${{ inputs.restart_service }}
        run: |
          ssh trafik-pi "sudo systemctl restart livetrafik-ws.service && sudo systemctl status livetrafik-ws.service --no-pager -n 20"
